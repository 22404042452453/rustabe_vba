' Скрипт для изменения времени отключения КЗ в сценарии

' Функция установки времени отключения КЗ
Sub SetShortCircuitClearingTime(tClear)
    On Error Resume Next
    
    Set tblEvents = Rastr.Tables("DFWAutoActionScn")
    
    If Not tblEvents Is Nothing Then
        Set colType = tblEvents.Cols("Type")
        Set colTimeStart = tblEvents.Cols("TimeStart")
        
        If Not colType Is Nothing And Not colTimeStart Is Nothing Then
            Dim kzTime
            Dim kzFound
            kzFound = False
            
            ' Ищем КЗ и запоминаем его время начала
            For i = 0 To tblEvents.Size - 1
                If colType.ZS(i) = "КЗ" Then
                    kzTime = colTimeStart.Z(i)
                    kzFound = True
                    
                    ' Ищем следующий "Шунт Z" после этого КЗ
                    For j = i + 1 To tblEvents.Size - 1
                        If colType.ZS(j) = "Шунт Z" Then
                            ' Устанавливаем время отключения КЗ
                            colTimeStart.Z(j) = kzTime + (tClear / 1000.0)
                            Exit For
                        End If
                    Next
                    Exit For
                End If
            Next
        End If
    End If
    
    On Error GoTo 0
End Sub

' Основная логика
tInput = InputBox("Введите время отключения КЗ (мс):", "Изменение времени", "500")

If IsNumeric(tInput) Then
    tClear = CDbl(tInput)
    
    ' Устанавливаем время отключения в сценарии
    Call SetShortCircuitClearingTime(tClear)
    
    ' Сохраняем только таблицу сценария
    saveRes = Rastr.Tables("DFWAutoActionScn").Save()
    
    If saveRes = 0 Then
        MsgBox "Время отключения КЗ установлено: " & tClear & " мс" & vbCrLf & "Сценарий сохранен."
    Else
        MsgBox "Ошибка сохранения сценария: " & saveRes
    End If
Else
    MsgBox "Неверный ввод времени."
End If
