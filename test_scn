' Скрипт для изменения длительности КЗ в сценарии и сохранения

' Функция установки длительности КЗ
Sub SetShortCircuitDuration(tClear)
    On Error Resume Next
    
    Set tblEvents = Rastr.Tables("DFWAutoActionScn")
    
    If Not tblEvents Is Nothing Then
        Set colType = tblEvents.Cols("Type")
        Set colDT = tblEvents.Cols("DT")  ' Длительность действия
        
        If Not colType Is Nothing And Not colDT Is Nothing Then
            For i = 0 To tblEvents.Size - 1
                ' Ищем действие типа "КЗ"
                If colType.ZS(i) = "КЗ" Then
                    ' Устанавливаем длительность КЗ в мс
                    colDT.Z(i) = tClear
                    Exit For  ' Обрабатываем только первое КЗ
                End If
            Next
        End If
    End If
    
    On Error GoTo 0
End Sub

' Основная логика
tInput = InputBox("Введите длительность КЗ (мс):", "Изменение времени", "500")

If IsNumeric(tInput) Then
    tClear = CDbl(tInput)
    
    ' Устанавливаем длительность в сценарии
    Call SetShortCircuitDuration(tClear)
    
    ' Сохраняем файл (пробуем разные варианты)
    On Error Resume Next
    saveRes = Rastr.Save(Rastr.fileName, "")
    If Err.Number <> 0 Then
        saveRes = -1
    End If
    On Error GoTo 0
    
    If saveRes = 0 Then
        MsgBox "Длительность КЗ установлена: " & tClear & " мс" & vbCrLf & "Сценарий сохранен."
    Else
        MsgBox "Длительность КЗ установлена: " & tClear & " мс" & vbCrLf & "Для сохранения используйте Файл -> Сохранить в меню RastrWin3."
    End If
Else
    MsgBox "Неверный ввод времени."
End If
