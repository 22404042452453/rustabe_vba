Sub TestRastrProtocol()
    Dim protocol, lines, i
    
    On Error Resume Next
    protocol = Rastr.Protocol
    If Err.Number <> 0 Then
        MsgBox "Ошибка: " & Err.Description
        Exit Sub
    End If
    On Error GoTo 0
    
    If Len(protocol) = 0 Then
        MsgBox "Протокол пустой!"
        Exit Sub
    End If
    
    MsgBox "Длина: " & Len(protocol) & " символов"
    
    Dim xl, wb, ws
    Set xl = CreateObject("Excel.Application")
    xl.Visible = True
    Set wb = xl.Workbooks.Add
    Set ws = wb.Worksheets(1)
    
    ws.Cells(1, 1).Value = "ПРОТОКОЛ:"
    ws.Cells(1, 1).Font.Bold = True
    ws.Cells(3, 1).Value = protocol
    ws.Cells(3, 1).WrapText = True
    
    If InStr(protocol, vbCrLf) > 0 Then
        lines = Split(protocol, vbCrLf)
    ElseIf InStr(protocol, vbLf) > 0 Then
        lines = Split(protocol, vbLf)
    Else
        lines = Split(protocol, vbCr)
    End If
    
    ws.Cells(5, 1).Value = "ПОСТРОЧНО (50 строк):"
    ws.Cells(5, 1).Font.Bold = True
    
    For i = 0 To UBound(lines)
        If i < 50 Then
            ws.Cells(6 + i, 1).Value = i + 1
            ws.Cells(6 + i, 2).Value = lines(i)
        End If
    Next
    
    ws.Columns(2).ColumnWidth = 120
    MsgBox "Готово! Строк: " & (UBound(lines) + 1)
End Sub
