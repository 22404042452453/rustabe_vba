' --- Поиск всех логов событий динамики ---

' Инициализация Excel для результатов
Set xl = CreateObject("Excel.Application")
xl.Visible = True
xl.DisplayAlerts = False
Set wb = xl.Workbooks.Add
Set ws = wb.Worksheets(1)
ws.Name = "События"

' Заголовок
ws.Cells(1, 1).Value = "№"
ws.Cells(1, 2).Value = "Таблица"
ws.Cells(1, 3).Value = "Найдена"
ws.Range("A1:C1").Font.Bold = True

' Запускаем расчет динамики
Set spFWDynamic = Rastr.FWDynamic

If Not spFWDynamic Is Nothing Then
    nRes = spFWDynamic.Run()
    
    If nRes = 0 Then
        rowNum = 2
        On Error Resume Next
        
        ' Список возможных таблиц для проверки
        tableNames = Array("dyn_log", "dynlog", "log", "events", "dyn_events", _
                          "arblok", "ar_block", "dynamic_log", "calc_log", _
                          "generator_log", "line_log", "protection_log")
        
        ' Проверяем каждую таблицу
        For i = 0 To UBound(tableNames)
            ws.Cells(rowNum, 1).Value = i + 1
            ws.Cells(rowNum, 2).Value = tableNames(i)
            
            Set tbl = Rastr.Tables(tableNames(i))
            If Not tbl Is Nothing Then
                ws.Cells(rowNum, 3).Value = "ДА (строк: " & tbl.Size & ")"
            Else
                ws.Cells(rowNum, 3).Value = "НЕТ"
            End If
            
            rowNum = rowNum + 1
        Next
        
        On Error GoTo 0
        
        ws.Columns.AutoFit
        
        MsgBox "Проверка таблиц завершена. Найдите таблицу со статусом 'ДА'", vbInformation, "Готово"
    Else
        MsgBox "Ошибка расчета FWDynamic (код: " & nRes & ")", vbExclamation, "Ошибка"
    End If
Else
    MsgBox "FWDynamic недоступен", vbCritical, "Ошибка"
End If
