' Файл для логов
logPath = "C:\Temp\rastr_log.txt"
Set fso = CreateObject("Scripting.FileSystemObject")
Set logFile = fso.CreateTextFile(logPath, True)

' Функция для записи в лог
Sub WriteLog(msg)
    logFile.WriteLine Now & " | " & msg
End Sub

' Перехват логов Rastr
Rastr.OnLog = GetRef("RastrLogHandler")

Sub RastrLogHandler(Code, Level, StageId, TableName, TableIndex, Description, FormName)
    WriteLog "Level " & Level & " | " & Description
End Sub

' Запуск динамики
WriteLog "Запуск динамики..."
On Error Resume Next
Rastr.rgm("p")
If Err.Number <> 0 Then
    WriteLog "ОШИБКА: " & Err.Description
End If
On Error GoTo 0
WriteLog "Динамика завершена"

logFile.Close

' Вывод логов в Excel
Set xl = CreateObject("Excel.Application")
xl.Visible = True
Set wb = xl.Workbooks.Add
Set ws = wb.Worksheets(1)

Set logFileRead = fso.OpenTextFile(logPath, 1)
i = 1
Do Until logFileRead.AtEndOfStream
    ws.Cells(i, 1).Value = logFileRead.ReadLine
    i = i + 1
Loop
logFileRead.Close

ws.Columns(1).AutoFit
MsgBox "Готово! Логов: " & (i-1)
