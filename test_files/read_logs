' --- Выгрузка логов динамики в Excel ---

' Инициализация Excel для результатов
Set xl = CreateObject("Excel.Application")
xl.Visible = True
xl.DisplayAlerts = False
Set wb = xl.Workbooks.Add
Set ws = wb.Worksheets(1)
ws.Name = "Логи"

' Заголовок
ws.Cells(1, 1).Value = "№"
ws.Cells(1, 2).Value = "Текст лога"
ws.Range("A1:B1").Font.Bold = True

' Запускаем расчет динамики
Set spFWDynamic = Rastr.FWDynamic

If Not spFWDynamic Is Nothing Then
    nRes = spFWDynamic.Run()
    
    If nRes = 0 Then
        ' Пробуем получить логи разными способами
        
        ' Вариант 1: Через LogMessages (если есть)
        If Not IsEmpty(spFWDynamic.LogMessages) Then
            logArray = spFWDynamic.LogMessages
            For i = 0 To UBound(logArray)
                ws.Cells(i + 2, 1).Value = i + 1
                ws.Cells(i + 2, 2).Value = logArray(i)
            Next
        ' Вариант 2: Через Log (если есть)
        ElseIf Not IsEmpty(spFWDynamic.Log) Then
            logText = spFWDynamic.Log
            msgLines = Split(logText, vbCrLf)
            If UBound(msgLines) = 0 Then msgLines = Split(logText, vbLf)
            For i = 0 To UBound(msgLines)
                ws.Cells(i + 2, 1).Value = i + 1
                ws.Cells(i + 2, 2).Value = msgLines(i)
            Next
        ' Вариант 3: Только ResultMessage
        Else
            ws.Cells(2, 1).Value = 1
            ws.Cells(2, 2).Value = spFWDynamic.ResultMessage
        End If
        
        ' Форматирование
        ws.Columns.AutoFit
        
        MsgBox "Логи выгружены", vbInformation, "Готово"
    Else
        MsgBox "Ошибка расчета FWDynamic (код: " & nRes & ")", vbExclamation, "Ошибка"
    End If
Else
    MsgBox "FWDynamic недоступен", vbCritical, "Ошибка"
End If
