' Запуск динамики
Set spFWDynamic = Rastr.FWDynamic
spFWDynamic.Run()

' Инициализация Excel
Set xl = CreateObject("Excel.Application")
xl.Visible = True
Set wb = xl.Workbooks.Add
Set ws = wb.Worksheets(1)
ws.Name = "Тест снимков"

ws.Cells(1, 1).Value = "Проверка снимков d_ip для ветви 0:"

Const MaxSnapshotIndex = 500

' Пробуем получить снимок d_ip
foundSnapshot = False
For snapIdx = 0 To MaxSnapshotIndex
    On Error Resume Next
    tmpPlot = Rastr.GetChainedGraphSnapshot("vetv", "d_ip", 0, snapIdx)
    errNum = Err.Number
    On Error GoTo 0
    
    If errNum = 0 And IsArray(tmpPlot) Then
        ws.Cells(2, 1).Value = "Снимок " & snapIdx & " найден!"
        ws.Cells(3, 1).Value = "Точек данных:"
        ws.Cells(3, 2).Value = UBound(tmpPlot, 1) + 1
        
        ' Выводим первые 10 точек
        ws.Cells(5, 1).Value = "d_ip"
        ws.Cells(5, 2).Value = "Time"
        
        maxRows = UBound(tmpPlot, 1) + 1
        If maxRows > 10 Then maxRows = 10
        
        For r = 0 To maxRows - 1
            ws.Cells(6 + r, 1).Value = tmpPlot(r, 0)
            ws.Cells(6 + r, 2).Value = tmpPlot(r, 1)
        Next
        
        foundSnapshot = True
        Exit For
    End If
Next

If Not foundSnapshot Then
    ws.Cells(2, 1).Value = "НИ ОДИН СНИМОК НЕ НАЙДЕН!"
    ws.Cells(3, 1).Value = "Проверьте:"
    ws.Cells(4, 1).Value = "1. Выполнился ли расчет динамики (есть ли сообщения в протоколе)?"
    ws.Cells(5, 1).Value = "2. Сохраняются ли снимки (настройки динамики)?"
End If

ws.Columns.AutoFit
MsgBox "Проверка завершена!"
